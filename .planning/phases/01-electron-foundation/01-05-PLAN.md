---
phase: 01-electron-foundation
plan: 05
type: execute
wave: 3
depends_on: [01-04]
files_modified: [electron/preload/index.ts, app/lib/electron.ts]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Renderer process can access database via electronAPI"
    - "TypeScript types provide autocomplete for electronAPI"
    - "IPC bridge exposes only specific, safe methods"
    - "Raw ipcRenderer never exposed to renderer"
  artifacts:
    - path: "electron/preload/index.ts"
      provides: "contextBridge-exposed electronAPI"
      contains: ["db:query", "db:exec"]
    - path: "app/lib/electron.ts"
      provides: "TypeScript types for electronAPI"
      min_lines: 20
      contains: ["interface ElectronAPI"]
  key_links:
    - from: "app/lib/electron.ts"
      to: "electron/preload/index.ts"
      via: "TypeScript interface matches exposed methods"
      pattern: "interface ElectronAPI"
    - from: "electron/preload/index.ts"
      to: "electron/main/ipc/handlers.ts"
      via: "ipcRenderer.invoke calls"
      pattern: "ipcRenderer\\.invoke\\('db:"
---

<objective>
Update preload script with IPC methods and create TypeScript types for type-safe electronAPI access from Next.js.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-electron-foundation/01-ELECTRON-VITE-RESEARCH.md
@.planning/phases/01-electron-foundation/01-04-SUMMARY.md
@electron/preload/index.ts
@electron/main/ipc/handlers.ts
</context>

<tasks>

<task type="auto">
  <name>Update preload script with IPC methods</name>
  <files>electron/preload/index.ts</files>
  <action>
    Modify electron/preload/index.ts:
    - Replace empty electronAPI object with database methods:
      * queryDatabase: (sql: string, params?: any[]) => ipcRenderer.invoke('db:query', sql, params)
      * execDatabase: (sql: string, params?: any[]) => ipcRenderer.invoke('db:exec', sql, params)
      * initDatabase: () => ipcRenderer.invoke('db:init')
    - Add TypeScript types for parameters and return values
    - Use proper TypeScript syntax

    Follow RESEARCH.md "Pattern 2: Preload Script with contextBridge" and "TypeScript IPC Types"
    Security: expose ONLY specific methods, not raw ipcRenderer.
  </action>
  <verify>electron/preload/index.ts exposes queryDatabase, execDatabase, initDatabase via contextBridge with TypeScript types</verify>
  <done>Secure IPC bridge exposed to renderer via contextBridge with TypeScript types</done>
</task>

<task type="auto">
  <name>Create TypeScript types for electronAPI</name>
  <files>app/lib/electron.ts</files>
  <action>
    Create app/lib/electron.ts with:
    - Declare global interface Window augmentation:
      ```typescript
      interface ElectronAPI {
        queryDatabase: (sql: string, params?: any[]) => Promise<any[]>;
        execDatabase: (sql: string, params?: any[]) => Promise<{ lastInsertRowid: number; changes: number }>;
        initDatabase: () => Promise<string>;
      }

      declare global {
        interface Window {
          electronAPI: ElectronAPI;
        }
      }

      export {};
      ```
    - This provides TypeScript autocomplete and type safety
    - Include JSDoc comments for documentation
    - Use proper TypeScript syntax

    File should be .ts (not .tsx) since it's not a React component.
    Follow RESEARCH.md "TypeScript IPC Types" example.
  </action>
  <verify>app/lib/electron.ts exists with ElectronAPI interface and Window augmentation</verify>
  <done>TypeScript types defined for electronAPI</done>
</task>

</tasks>

<verification>
- Preload script exposes three database methods with TypeScript types
- Methods use ipcRenderer.invoke (not send/on)
- TypeScript interface matches exposed methods
- Window interface augmented for global access
- No raw ipcRenderer exposed
- Proper TypeScript syntax used
</verification>

<success_criteria>
IPC bridge with TypeScript types enabling type-safe database access from Next.js renderer process.
</success_criteria>

<output>
After completion, create `.planning/phases/01-electron-foundation/01-05-SUMMARY.md`
</output>
