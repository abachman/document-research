---
phase: 01-electron-foundation
plan: 03
type: execute
wave: 2
depends_on: [01-02]
files_modified: [main/index.js, preload/index.js]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Application launches as desktop window"
    - "Next.js frontend displays in desktop window"
    - "Development server loads in dev mode, production build in prod mode"
    - "Preload script uses contextBridge for secure API exposure"
  artifacts:
    - path: "main/index.js"
      provides: "Electron main process entry point"
      min_lines: 30
      contains: ["BrowserWindow", "app.whenReady", "loadURL"]
    - path: "preload/index.js"
      provides: "Preload script with contextBridge"
      min_lines: 15
      contains: ["contextBridge", "exposeInMainWorld"]
  key_links:
    - from: "main/index.js"
      to: "http://localhost:3000"
      via: "loadURL in development mode"
      pattern: "loadURL.*localhost:3000"
    - from: "main/index.js"
      to: ".webpack/renderer"
      via: "loadFile in production mode"
      pattern: "loadFile.*renderer"
    - from: "preload/index.js"
      to: "renderer process"
      via: "contextBridge.exposeInMainWorld"
      pattern: "contextBridge\\.exposeInMainWorld"
---

<objective>
Create Electron main process and preload script with secure contextBridge pattern for Next.js integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-electron-foundation/01-RESEARCH.md
@.planning/phases/01-electron-foundation/01-02-SUMMARY.md
@forge.config.js
</context>

<tasks>

<task type="auto">
  <name>Create Electron main process</name>
  <files>main/index.js</files>
  <action>
    Create main/index.js with:
    - Import electron, path, and electron-is-dev
    - createWindow function:
      * BrowserWindow with width 1200, height 800
      * webPreferences: preload path, contextIsolation: true, nodeIntegration: false
      * Use MAIN_WINDOW_WEBPACK_ENTRY magic global for renderer path
      * In dev: loadURL to http://localhost:3000
      * In prod: loadFile to packaged renderer
      * DevTools open in dev mode
    - app.whenReady().then(createWindow)
    - app.on('window-all-closed') with platform check (quit unless darwin)
    - app.on('activate') with window recreation if all closed (darwin)

    Follow RESEARCH.md "Pattern 1: Electron + Next.js Integration"
  </action>
  <verify>main/index.js exists with BrowserWindow, createWindow, dev/prod load logic</verify>
  <done>Electron main process created with Next.js loading logic</done>
</task>

<task type="auto">
  <name>Create preload script with contextBridge</name>
  <files>preload/index.js</files>
  <action>
    Create preload/index.js with:
    - Import contextBridge and ipcRenderer from electron
    - Use contextBridge.exposeInMainWorld to create 'electronAPI' object
    - For now, expose empty object (will add IPC methods in 01-04)
    - Use MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY magic global for path detection

    Follow RESEARCH.md security best practices:
    - contextIsolation: true (enforced by default)
    - Only expose specific APIs via contextBridge
    - Never expose raw ipcRenderer
  </action>
  <verify>preload/index.js exists with contextBridge.exposeInMainWorld('electronAPI', {})</verify>
  <done>Secure preload script created with contextBridge pattern</done>
</task>

</tasks>

<verification>
- Main process creates BrowserWindow with correct security settings
- Preload script uses contextBridge
- Development mode loads from localhost:3000
- Production mode loads from packaged renderer
- Window lifecycle managed correctly for platform
</verification>

<success_criteria>
Electron application launches as desktop window showing Next.js frontend with proper development/production loading logic.
</success_criteria>

<output>
After completion, create `.planning/phases/01-electron-foundation/01-03-SUMMARY.md`
</output>
