---
phase: 01-electron-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, main/index.js, preload/index.js, forge.config.js, webpack.main.config.js, webpack.renderer.config.js, .gitignore]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Application launches as desktop window"
    - "Next.js frontend displays in desktop window"
    - "Development server loads in dev mode, production build in prod mode"
  artifacts:
    - path: "main/index.js"
      provides: "Electron main process entry point"
      min_lines: 30
      contains: ["BrowserWindow", "app.whenReady", "loadURL"]
    - path: "preload/index.js"
      provides: "Preload script with contextBridge"
      min_lines: 15
      contains: ["contextBridge", "exposeInMainWorld"]
    - path: "forge.config.js"
      provides: "Electron Forge configuration"
      min_lines: 20
      contains: ["plugins", "webpack"]
    - path: "webpack.main.config.js"
      provides: "Main process webpack configuration"
      min_lines: 15
      contains: ["target: 'electron-main'", "entry"]
    - path: "package.json"
      provides: "Electron dependencies and scripts"
      contains: ["electron", "@electron-forge/cli"]
  key_links:
    - from: "main/index.js"
      to: "http://localhost:3000"
      via: "loadURL in development mode"
      pattern: "loadURL.*localhost:3000"
    - from: "main/index.js"
      to: ".webpack/renderer"
      via: "loadFile in production mode"
      pattern: "loadFile.*renderer"
---

<objective>
Create Electron desktop application wrapper for existing Next.js frontend, with development and production build configurations using Electron Forge and webpack plugin.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-electron-foundation/01-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Install Electron dependencies and Forge</name>
  <files>package.json</files>
  <action>
    Install Electron and Electron Forge packages:
    - Run: `pnpm add --save-dev electron @electron-forge/cli @electron-forge/plugin-webpack electron-is-dev`
    - Run: `pnpm add better-sqlite3` (needed for Phase 1-02)
    - Run: `npx electron-forge import` to initialize Forge configuration
    - Update package.json main entry to "./.webpack/main"
    - Add Forge scripts to package.json:
      * "electron:dev": "electron-forge start"
      * "electron:package": "electron-forge package"
      * "electron:make": "electron-forge make"

    DO NOT modify existing Next.js scripts (dev, build, start, lint).
  </action>
  <verify>package.json contains electron, @electron-forge/cli, @electron-forge/plugin-webpack, electron-is-dev, better-sqlite3 in dependencies/devDependencies</verify>
  <done>All Electron packages installed, Forge initialized, main entry configured</done>
</task>

<task type="auto">
  <name>Create Electron main process</name>
  <files>main/index.js</files>
  <action>
    Create main/index.js with:
    - Import electron, path, and electron-is-dev
    - createWindow function:
      * BrowserWindow with width 1200, height 800
      * webPreferences: preload path, contextIsolation: true, nodeIntegration: false
      * Use MAIN_WINDOW_WEBPACK_ENTRY magic global for renderer path
      * In dev: loadURL to http://localhost:3000
      * In prod: loadFile to packaged renderer
      * DevTools open in dev mode
    - app.whenReady().then(createWindow)
    - app.on('window-all-closed') with platform check (quit unless darwin)
    - app.on('activate') with window recreation if all closed (darwin)

    Follow RESEARCH.md "Pattern 1: Electron + Next.js Integration"
  </action>
  <verify>main/index.js exists with BrowserWindow, createWindow, dev/prod load logic</verify>
  <done>Electron main process created with Next.js loading logic</done>
</task>

<task type="auto">
  <name>Create preload script with contextBridge</name>
  <files>preload/index.js</files>
  <action>
    Create preload/index.js with:
    - Import contextBridge and ipcRenderer from electron
    - Use contextBridge.exposeInMainWorld to create 'electronAPI' object
    - For now, expose empty object (will add IPC methods in 01-02)
    - Use MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY magic global for path detection

    Follow RESEARCH.md security best practices:
    - contextIsolation: true (enforced by default)
    - Only expose specific APIs via contextBridge
    - Never expose raw ipcRenderer
  </action>
  <verify>preload/index.js exists with contextBridge.exposeInMainWorld('electronAPI', {})</verify>
  <done>Secure preload script created with contextBridge pattern</done>
</task>

<task type="auto">
  <name>Configure Electron Forge webpack plugin</name>
  <files>forge.config.js</files>
  <action>
    Create forge.config.js with:
    - packagerConfig: {} (default settings)
    - rebuildConfig: {} (for native modules)
    - makers: Array with @electron-forge/maker-zip for darwin platform
    - plugins: Array with @electron-forge/plugin-webpack
      * mainConfig: './webpack.main.config.js'
      * renderer.config: './webpack.renderer.config.js'
      * entryPoints: Array with single entry:
        - name: 'main_window'
        - html: './.next/server/app/page.html' (or dev equivalent)
        - js: './.webpack/renderer/index.js'
        - preload: { js: './preload/index.js' }

    Follow RESEARCH.md "Forge Configuration with Webpack" example
  </action>
  <verify>forge.config.js exists with webpack plugin configuration</verify>
  <done>Forge configured with webpack plugin for development and packaging</done>
</task>

<task type="auto">
  <name>Create webpack main config</name>
  <files>webpack.main.config.js</files>
  <action>
    Create webpack.main.config.js with:
    - mode: process.env.NODE_ENV || 'development'
    - target: 'electron-main'
    - node: { __dirname: false, __filename: false }
    - entry: './main/index.js'
    - output: { path: __dirname + '/.webpack', filename: 'main/[name].js' }
    - module: rules for .node files (node-loader) and JS/node files (@vercel/webpack-asset-relocator-loader)

    Follow RESEARCH.md "Webpack Main Config" example for native module support
  </action>
  <verify>webpack.main.config.js exists with electron-main target</verify>
  <done>Main process webpack config created with native module support</done>
</task>

<task type="auto">
  <name>Create webpack renderer config</name>
  <files>webpack.renderer.config.js</files>
  <action>
    Create webpack.renderer.config.js with:
    - mode: process.env.NODE_ENV || 'development'
    - target: 'web' (for Next.js integration with nodeIntegration: false)
    - entry: Use Next.js dev server in dev, packaged build in prod
    - output: { path: __dirname + '/.webpack', filename: 'renderer/[name].js' }
    - devServer: { static: directory for renderer, hot: true }

    NOTE: This config works with Electron Forge's webpack plugin to load Next.js.
    In dev: Forge HMR connects to Next.js dev server
    In prod: Packaged Next.js static export loads via loadFile
  </action>
  <verify>webpack.renderer.config.js exists with web target</verify>
  <done>Renderer webpack config created for Next.js integration</done>
</task>

<task type="auto">
  <name>Update .gitignore for Electron artifacts</name>
  <files>.gitignore</files>
  <action>
    Add to .gitignore:
    - .webpack/ (Forge build output)
    - out/ (Forge package output)
    - .forge/ (Forge cache)
    - *.log (Electron logs)

    Keep existing .next, node_modules, etc.
  </action>
  <verify>.gitignore contains .webpack/, out/, .forge/ entries</verify>
  <done>Build artifacts excluded from git</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Electron desktop application with Next.js integration</what-built>
  <how-to-verify>
    1. Start Next.js dev server: `pnpm dev` (leave running)
    2. In new terminal: `pnpm electron:dev`
    3. Expected: Desktop window opens showing Next.js frontend
    4. Verify window title, size (1200x800), and content matches localhost:3000
    5. Check DevTools open automatically (dev mode)
    6. Test window close behavior (app quits on Windows/Linux, stays on macOS)

    If build errors occur:
    - Check .webpack directory exists
    - Check main/index.js loads correctly
    - Check forge.config.js entryPoints
  </how-to-verify>
  <resume-signal>Type "approved" if Electron window opens with Next.js content, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- Electron launches without errors
- Desktop window displays Next.js homepage
- DevTools open in development mode
- Window close behaves correctly for platform
- No console errors in main or renderer process
</verification>

<success_criteria>
Electron application launches as desktop window showing Next.js frontend with proper development/production loading logic and webpack hot module replacement.
</success_criteria>

<output>
After completion, create `.planning/phases/01-electron-foundation/01-01-SUMMARY.md`
</output>
