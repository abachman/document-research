---
phase: 01-electron-foundation
plan: 07
type: execute
wave: 4
depends_on: [01-05, 01-06]
files_modified: []
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Electron application launches and displays Next.js frontend"
    - "Database operations work from renderer process"
    - "Application menu displays and functions correctly"
    - "Window lifecycle managed properly for platform"
  artifacts: []
  key_links: []
---

<objective>
Verify complete Electron desktop application integration with database access, IPC bridge, and native menu.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-electron-foundation/01-RESEARCH.md
@.planning/phases/01-electron-foundation/01-03-SUMMARY.md
@.planning/phases/01-electron-foundation/01-04-SUMMARY.md
@.planning/phases/01-electron-foundation/01-05-SUMMARY.md
@.planning/phases/01-electron-foundation/01-06-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Electron desktop application with Next.js integration, SQLite database, IPC bridge, and native menu</what-built>
  <how-to-verify>
    **1. Application Launch Test:**
    - Start Next.js dev server: `pnpm dev` (leave running)
    - In new terminal: `pnpm electron:dev`
    - Expected: Desktop window opens showing Next.js frontend
    - Verify window title, size (1200x800), and content matches localhost:3000
    - Check DevTools open automatically (dev mode)
    - Test window close behavior (app quits on Windows/Linux, stays on macOS)

    **2. Database IPC Bridge Test:**
    - Create test file app/electron-ipc-test/page.tsx:
      ```tsx
      'use client';

      export default function IPCTest() {
        const testIPC = async () => {
          try {
            await window.electronAPI.initDatabase();
            console.log('Database initialized');

            // Insert test annotation
            await window.electronAPI.execDatabase(
              'INSERT INTO annotations (type, text, position) VALUES (?, ?, ?)',
              ['highlight', 'Test text', '{"page": 1}']
            );
            console.log('Insert successful');

            // Query annotations
            const results = await window.electronAPI.queryDatabase('SELECT * FROM annotations');
            console.log('Query results:', results);
          } catch (error) {
            console.error('IPC error:', error);
          }
        };

        return (
          <div className="p-4">
            <h1>IPC Bridge Test</h1>
            <button onClick={testIPC}>Test IPC</button>
          </div>
        );
      }
      ```
    - Visit http://localhost:3000/electron-ipc-test
    - Click "Test IPC" button
    - Expected: Browser console shows "Database initialized", "Insert successful", and query results array
    - Check userData directory for annotations.db file:
      * macOS: ~/Library/Application Support/document-research/annotations.db
      * Windows: %APPDATA%/document-research/annotations.db
      * Linux: ~/.config/document-research/annotations.db

    **3. Application Menu Test:**

    **macOS verification:**
    - Menu bar shows app name (Document Research) at left
    - App menu contains: About, Hide, Hide Others, Unhide, Quit
    - File menu contains: Close Window
    - Edit menu contains: Undo, Redo, Cut, Copy, Paste, Select All
    - View menu contains: Reload, Force Reload, Toggle Developer Tools, Reset Zoom, Zoom In, Zoom Out, Toggle Fullscreen
    - Help menu contains: Documentation, Report Issue
    - Test keyboard shortcuts: Cmd+C (copy), Cmd+V (paste), Cmd+Q (quit)

    **Windows/Linux verification:**
    - Menu bar below title bar shows: File, Edit, View, Help
    - File menu contains: Close Window (or Exit on Windows)
    - Edit menu contains: Undo, Redo, Cut, Copy, Paste, Select All
    - View menu contains: Reload, Force Reload, Toggle Developer Tools, Reset Zoom, Zoom In, Zoom Out, Toggle Fullscreen
    - Help menu contains: Documentation, Report Issue
    - Test keyboard shortcuts: Ctrl+C (copy), Ctrl+V (paste), Alt+F4 (quit)

    **4. Functionality Tests:**
    - Select text in Next.js app → Edit → Copy should be enabled
    - View → Toggle Developer Tools should open/close DevTools
    - View → Reload should refresh the page
    - View → Zoom In/Out should scale content
    - Help → Documentation should open browser to GitHub repo

    **If errors occur:**
    - Check .webpack directory exists
    - Check main/index.js loads correctly
    - Check forge.config.js entryPoints
    - Check better-sqlite3 compiled correctly (native module)
    - Check IPC handlers registered in main process
    - Check console for specific error messages
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- Electron launches without errors
- Desktop window displays Next.js homepage
- Database operations work from renderer process
- IPC bridge functions correctly
- Application menu displays and functions
- Platform-specific behavior handled correctly
- TypeScript types provide autocomplete
- No console errors in main or renderer process
</verification>

<success_criteria>
Complete Electron desktop application foundation with Next.js integration, SQLite database, secure IPC bridge, TypeScript types, and native application menu.
</success_criteria>

<output>
After completion, create `.planning/phases/01-electron-foundation/01-07-SUMMARY.md`
</output>
